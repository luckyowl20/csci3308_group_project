{{#section 'scripts'}}
    <!-- Bootstrap JS bundle (includes Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/resources/js/profile/profileScript.js"></script>
{{/section}}

<div class="container mt-4">
  <div class="row">
    <div class="col-md-4 text-center">
      <img src="{{profile.profile_picture_url}}" alt="Profile Picture" class="img-fluid rounded-circle mb-3" style="max-width: 200px;">
      <h3>{{profile.display_name}}</h3>
      <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</button>
    </div>
    <div class="col-md-8">
      <h4>Biography</h4>
      <p>{{profile.biography}}</p>

      <h4>Interests</h4>
      <p>{{profile.interests}}</p>

      <h4>Birthday</h4>
      <p>{{formatDate profile.birthday}}</p>

      <h4>Favorite Song</h4>
      {{#if profile.spotify_song_id}}
      <iframe style="border-radius:12px"
          src="https://open.spotify.com/embed/track/{{profile.spotify_song_id}}"
          width="100%" height="80" frameBorder="0"
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
          loading="lazy">
      </iframe>
      {{else}}
      <p><em>No favorite song selected yet.</em></p>
      {{/if}}

      <h4 class="mt-4">My Week</h4>
      <div class="row">
        {{#each recentPhotos}}
          <div class="col-md-4 mb-3">
            <img src="{{this.url}}" class="img-fluid rounded" alt="Photo">
          </div>
        {{/each}}
      </div>
    </div>
  </div>
</div>


<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="/profile/update" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input name="display_name" class="form-control mb-2" placeholder="Display Name" value="{{profile.display_name}}">
        <textarea name="biography" class="form-control mb-2" placeholder="Biography">{{profile.biography}}</textarea>
        <input name="interests" class="form-control mb-2" placeholder="Interests" value="{{profile.interests}}">
        <input name="birthday" type="date" class="form-control mb-2" value="{{profile.birthday}}">
        <input name="profile_picture_url" class="form-control mb-2" placeholder="Profile Picture URL" value="{{profile.profile_picture_url}}">

        <!-- Spotify Track Search -->
        <label for="spotify-search" class="form-label">Favorite Song</label>
        <input type="text" id="spotify-search" class="form-control mb-2" placeholder="Search for a song...">
        <input type="hidden" name="spotify_song_id" id="spotify_song_id_input" value="{{profile.spotify_song_id}}">
        <div id="spotify-results" class="mb-3" style="max-height: 300px; overflow-y: auto;"></div>

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </div>
    </form>
  </div>
</div>

