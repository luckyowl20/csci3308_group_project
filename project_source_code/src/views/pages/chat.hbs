

<!-- views/chat.hbs -->
{{#section "scripts"}}
  <script src="/socket.io/socket.io.js"></script>
  <script src="/resources/js/chat/chatScript.js"></script>
{{/section}}

<div class="container py-4">
  <div class="row">
    <!-- Friends List Sidebar -->
    <div class="col-md-3 border-end">
      <p class="mb-1 h-1 green-text" style="font-size: 2rem;">Friends</p>
      {{!-- <ul class="list-unstyled">
        {{#each friends}}
          <li class="mb-3">
            <!-- 
              Click friend to load messages. 
              We pass friend.id in the URL to identify which conversation. 
            -->
            <a href="/chat/{{this.id}}" class="text-decoration-none">
              <span>{{this.username}}</span>
            </a>
          </li>
        {{/each}}
      </ul> --}}
      <ul class="list-unstyled">
  {{#each friends}}
    <li class="mb-3 d-flex align-items-center">
      <img src="{{this.profilePicture}}" alt="{{this.username}}'s profile picture" 
           class="rounded-circle me-2" width="40" height="40">
      <a href="/chat/{{this.id}}" class="text-decoration-none" style="font-family: 'Montserrat'">
        <span>{{this.username}}</span>
      </a>
    </li>
  {{/each}}
</ul>

    </div>

    <!-- Chat Panel -->
    <div class="col-md-9">
      {{!-- Chat header partial displays friendâ€™s name if selected; otherwise shows default text --}}
      {{> chat_header user=chatPartner}}
      
      <div class="card">
        <div class="card-body overflow-auto" style="height: 400px;" id="chat-box" data-chat-partner-id="{{chatPartnerId}}" data-current-user-id="{{currentUserId}}">
          {{#if chatPartner}}
            {{#if messages.length}}
              {{#each messages}}
                {{> message_bubble message=this }}
              {{/each}}
            {{else}}
              <p class="text-muted" style="font-family: 'Montserrat'">No messages yet.</p>
            {{/if}}
          {{else}}
            <p class="text-muted" style="font-family: 'Montserrat'">Select a friend from the list to start chatting.</p>
          {{/if}}
        </div>
        {{!-- Only render the chat input if a chat partner is selected --}}
        {{#if chatPartner}}
          <div class="card-footer">
            {{> chat_input chatPartnerId=chatPartner.id }}
          </div>
        {{/if}}
      </div>
  </div>
</div>